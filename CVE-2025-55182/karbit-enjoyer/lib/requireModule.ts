function resolveReference(ref: string, chunks: any[]) {
  // "$1:constructor:constructor"
  if (!ref.startsWith("$")) return ref;

  const [, rest] = ref.split("$");
  const [index, ...path] = rest.split(":");

  return {
    base: chunks[Number(index)],
    path,
  };
}

export function requireModule(chunks: any[], ref: string) {
  const resolved = resolveReference(ref, chunks);
  if (!resolved) return null;

  //   @ts-ignore
  let obj = resolved.base;

  //   @ts-ignore
  for (const key of resolved.path) {
    obj = obj[key]; // ‚ùå UNSAFE (INTENTIONAL)
  }

  return obj;
}
